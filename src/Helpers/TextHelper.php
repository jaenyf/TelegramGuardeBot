<?php

namespace TelegramGuardeBot\Helpers;

/**
 * @author jaenyf
 */
class TextHelper
{
    private const homoglyphes = array(
        "'" => "â€™",
        "\"" => "Â«Â»",
        "a" => "ð’¶Ã£âºÎ±ðœ¶ð›¼ÇŽÉ‘Ã¢ð–†ð–ºð‘ŽÐ°ðšð›‚ð—®ï½Ã¡áº¡Ã¤ð“ªÃ ÄƒÃ¥È§að’‚ðžªð•’ð”žðšŠð°Ä…ð™–ð˜¢",
        "b" => "ð—¯ð–‡Ð¬á¸‡Æ…áá–¯á¸…ð“«ð•“ð‘á¸ƒÉ“ð˜£ð™—Æ„ð›ï½‚ð’ƒð’·ð–»ð”Ÿbðš‹Ê™",
        "c" => "Ã§ð½á´„â²¥ð–¼ð˜¤ð’¸ð™˜ð’„ð“¬ê®¯Ï²ðœÑð•”ð—°ð” ðº€ cðšŒð‘ð–ˆâ…½ï½ƒ",
        "d" => "ð—±ê“’ð™™ð••Ôá§ð’¹É—ð–½ð˜¥á¸Äï½„ð’…dÉ–ðšá‘¯â…¾ð“­ðá¸“ð‘‘Õªá¸‘á¸‹ð”¡Ä‘cá¸bð–‰â…†",
        "e" => "ê¬²ð–Šð•–ðšŽâ„®ÃªÄ—ð”¢â…‡È©Ò½ð–¾Ä“ð’†á¸›Ä•ð‘’É‡ð“®áº¹â„¯ð™šÄ™ð˜¦Ã©eðžÃ«Ã¨ÐµÄ›cï½…ð—²",
        "f" => "ð”£ð™›êž™ð’»ðšÆ’ï½†ð‘“ð—³áºfð•—ð’‡ðŸ‹ð“¯Ö„ð˜§ê¬µÅ¿ð–¿ðŸð–‹Ïá¸Ÿêœ°",
        "g" => "É¡á¶ƒð—´ð”¤É¢Ç§ð gð˜¨Ä£ð•˜ï½‡Õ¶ÖÄ¡â„Šð—€Äð’ˆÇ¥ðšÆð“°ð™œð‘”ð–ŒÄŸÇµ",
        "h" => "Ä§ÈŸÕ°á‚â±¨ðš‘áº–Ò»ð”¥ð’½á¸¥á¸©ð–â„Žð•™ð˜©ð—ð¡É¦ð’‰ð—µï½ˆhÄ¥á¸§ð“±ð™á¸£á¸«",
        "i" => "Ã®Î¹ð¸iá›É¨ê­µØ§ðš¤ð°° ð¢ð‘–ð•šðš’È‹áŽ¥Ë›ð â³ðœ„ð—‚á¾¾Ñ–ê™‡â…°ð›ŠÉªð–Žá»‰Ä«Ä­ï½‰Íºð’¾ð“²Ã­É©â„¹ð”¦ð—¶ð‘£ƒðœ¾ðž²á»‹ÇÃ¯â…ˆÄ±ð˜ªÃ¬ð’Š",
        "j" => "ð”§ðš“jÏ³ð—·ð£ð™Ÿð’‹ð—ƒð’¿ð‘—ð–É‰ð˜«ÊÑ˜â…‰ð•›ï½Šð“³",
        "k" => "ð¤ð‘˜ð—„ð—¸ðš”á¸³á¸µð“´ð“€ï½‹Îºâ±ªð•œkð”¨ð–ð’ŒÄ·ð™ ð˜¬á´‹",
        "l" => "l",
        "m" => "á´ï½má¹â…¿á¸¿á¹ƒÉ±",
        "n" => "ð“ƒï½Žðš—Ã±ð§ð’Õ¼ð™£mêž‘ð—‡ð˜¯á¹…Å„Å†ð“·ð—»Ç¹É´ná¹‡Åˆð‘›á¹‰Õ¸ð•Ÿð–“ð”«",
        "o" => "Ã´Ã¶á´Î¿Ð¾ï½",
        "p" => "Æ¥ð—‰á¹—ð†á¹•ð’‘ð›’ð•¡ð”­ï½ðš™Ïð”â´ðœŒðž€ð“¹Æ¿Ï±â²£ð‘ð–•ðžºpð“…ð©Ñ€ð™¥ðžŽð˜±ð› ð—½ðŸˆðœšá´˜ê®²á´©",
        "q" => "ðªð––ð‘žÕ£ï½‘Ê qð˜²ðššÔ›ð•¢ð“†ð”®ð—¾ð’’ð—Šá‚³ð™¦Õ¦ð“º",
        "r" => "ð“‡ð«á¹›rá´¦ê­ˆð‘ŸÉ¼á¹™á¹Ÿð˜³ê­‡ð—¿È‘ð—‹Ô»Ð³É¾Å•ÉÈ“ð”¯â²…Å—ï½’ð’“Å™ð™§Ê€É½ðš›ê®ð–—ð•£ð“»",
        "s" => "ðµ  êœ±ð‘£ð˜€á‚½Ð…á¹£Æ½ð“¼Åá¹¡ð‘ˆï¼³Ê‚ð‘ ð Å›ð™¨ð“ˆð–˜sï½“ð•¤ášð¬ð”°ð—ŒðšœÑ•ð’”ê®ªð˜´È™Å¡Õ",
        "t" => "ð­ð’•ð‘¡á¹«áŽ¢ð–™È›ð˜ð“½Æ«Ï„ð”±Å£ð™©ï½”ð“‰ð—ð˜µðšá¹­tð•¥Å§",
        "u" => "ð•¦ð‘£˜Å¯Å«Ç”Ã¹Uê­Žï½•Õï¼µÅ³Å±Æ°ð—ŽêžŸÊ‰Õ½Ã»Ô±ð–šð®ðž„ð˜‚ð˜¶ð›–ð“¶ðœÃºuÅ©È—á»¥ð’–ð“Šð”²Ã¼Ï…Î¼ðŠÊ‹ð‘¢Å­È•ðž¾ð“¾ð™ªðšžá´œê­’",
        "v" => "ð’—â‹ðšŸð‘£€ð—ÑµÑ´ðœˆðž¶ð‘£ð“‹ð¯ð”³ð˜ƒï½–ð¼vâ±±Î½×˜â±´ð–›á´ ð˜·âˆ¨â…´ð™«ð•§á¹½ê®©ð“¿á¹¿á¶Œð‘œ†ð›Žð‚",
        "w" => "ð‘œŠáº…ð‘¤ð‘œŽð˜„áº˜ð–œÉ¯ð’˜ð”€ð—ð˜¸vï½—ðš áº‡áºð°áº‰Wwáºƒð”´Ôê®ƒð•¨Õ¡â±³ð‘œð™¬áŽ³Åµá´¡ð“ŒÑ¡",
        "x" => "ï½˜ð±â¤¬ð˜…ð™­ð“ð”á•½á•ð—‘ð–ð‘¥á™®Ñ…ðš¡ð”µÃ—â¤«â…¹Ï‡ð’™ð˜¹xâ¨¯ð•©",
        "y" => "ð›„ð•ªð“ŽÊÉ£ð—’ð’šÒ®Å·Î³Æ´ðš¢á»¿ð›¾ð‘£œâ„½ðž¬Éê­šáºð”‚ð”¶áƒ§ð²á»µð˜†Ò¯ð–žÈ³yÃ½Ã¿Ñƒð˜ºð™®ð‘¦á¶Œð²ðœ¸",
        "z" => "ð–Ÿð•«ð™¯ê®“Åºð˜»ï½šáƒð—“ð”ƒð˜‡ÊÆ¶Å¼ð³â±¬áº•ð“ð’›á´¢áº“ð‘§ðš£ð‘£„ð”·z",
        "A" => "ð—”ð– ð™°ð˜ˆAð˜¼ðœœê­ºá—…ð’œê“®ð”¸áŽªð“ðš¨Ã…Ãð”„ð–ð´Ã€ðžðŠ á´€Ã‚ð€ÃƒÐð–½€ð‘¨ð•¬ð›¢ï¼¡Ã„Î‘",
        "B" => "ð›£ðž‘á—·ÃŸð—•êž´ï¼¢ð–¡ðœðŠ¡Î’ð‘©ð”¹ð“‘ð”…Ð²ð˜‰á›’ðµð™±ð—ê“Ð’ðá¼ðš©â„¬BÎ²ðŒðŠ‚ð˜½Ê™ð•­á´",
        "C" => "â²¤ð‘ªð‘£©ðŸŒï¼£â„­ð™²ð’žê“šð“’áŸðŠ¢â„‚ð¶Cð”œð—–ð‚â…­ðŒ‚ð‘£²Ð¡ð˜¾ð˜Šðº€ ð–¢ð•®Ï¹ð•ð ",
        "D" => "ð““ð——á—žð”»ð˜¿Äá—ªð·ð™³ð–£ð’ŸÄŽê““Dâ……â…®ð•¯ð”‡á´…ðƒð‘«ð˜‹ï¼¤áŽ ê­°",
        "E" => "ð™€ÃˆÄšð”ˆÃ‰á´‡ð˜Œð”¼Ð•ð‘¢¦ðœ Ä’â„°â‹¿ðšÄ”Î•Ã‹ð›¦ð‘¬ðš¬ð—˜ðž”ê­¼Ä–Eð•°ï¼¥Ä˜ð‘¢®ð–¤ð™´ðŠ†ð“”ð¸ê“°ÃŠð„áŽ¬â´¹",
        "F" => "ð™ð”½ð‘­Fð™µê“ð¹á–´ðŸŠðŠ‡ð…ðˆ“êž˜ð•±ð”‰ð“•ð–¥â„±ð—™ð‘¢¢ï¼¦ð‘£‚ð”¥ðŠ¥Ïœð˜",
        "G" => "ð˜Žï¼§Ôð—šÉ¢ðºð”¾ð™‚ð‘®ð•²á€Õ¶ê®ð’¢á»ê“–ÔŒð“–Gð”Šð†ð™¶ð–¦á³",
        "H" => "ðž–ð‡ðœð—›â„ð›¨ð˜â²Žð–§ðœ¢ð™·ê“§Ð½áŽ»â„‹ê®‹ðš®Há•¼ð“—ð»ð‘¯Êœð™ƒÎ—ð‹ï¼¨ð•³Ðâ„Œ",
        "I" => "Î¹ð¸â… á›ê­µØ§Óðš¤Î™ð°° ð¢ð‘–Ð†ð•šðš’áŽ¥Ë›ð â³ðœ„Ið—‚á¾¾Ñ–ê™‡â…°ð›ŠÉªð–ŽÄ«ð™žï½‰Íºð’¾ð“²É©â„¹ð”¦ð—¶ð‘£ƒðœ¾ðž²â…ˆÄ±ð˜ªï¼©ð’Š",
        "J" => "ð”ð“™áŽ«ð•á´Šï¼ªð’¥ð™¹ð‘±Í¿ð™…Õµð½Jê­»ð—ð•µÐˆá’ð‰ê“™ð–©êž²ð˜‘",
        "K" => "ð™†ð›«ð‘²ð¾ð•‚ð’¦ðž™ð“šð–ªð˜’ÐšðŸá›•ê“—ð™ºð”˜Kâ„ªðš±ð”ŽðŠð—žâ²”ð•¶á¦Îšðœ¥ï¼«",
        "L" => "Î¹ð‘ƒï¼¬â³ð•ƒð™‡ð‘¢£Lð‹ð“›ð”ð•·ðˆªlð›ð™»ð¿â³‘ÊŸâ…¬ð‘³ð”¦ê“¡ð˜“ážá’ªâ„’ð–«ê®®ð–¼–â…¼ð—Ÿð‘¢²",
        "M" => "ðœ§áŽ·â„³ð›­ð¡Îœðž›ð‘€ð— ð™¼ð”Ïºðš³ðŠ°ðŒð™ˆâ…¯ð˜”á—°Ðœð–¬ðŒ‘ð“œMê“Ÿá›–â²˜ð‘´ð•¸ï¼­ð•„",
        "N" => "ð”“ð‘µð¢ð™½ï¼®ðš´ð’©ðžœð™‰ð•¹â„•ðâ²šð›®ð˜•ð”‘ð–­ðœ¨NÉ´ð—¡ê“ ð‘ð“Î",
        "O" => "Ã”Ã–ÎŸÕ•Ðžð±  ï¼¯Oð ",
        "P" => "ð™‹ð‘·ðœ¬á¢ðž ðš¸â„™ð˜—ð™¿Ð á‘­Î¡ê“‘ðð¦ð“ŸðŠ•ð–¯ð›²â²¢Pï¼°ð”“ð‘ƒð’«ð—£ð•»",
        "Q" => "Qâ„šð–°ð™Œðš€ð—¤ð˜˜ðá‚³á‚­ð‘„âµ•ð•¼ð‘¸ð’¬ð””ð“ ï¼±",
        "R" => "ê­±ð’´ð˜™ï¼²ð‘…â„ê®¢á–‡â„›áš±â„œðšð‘Æ¦Rðˆ–ê“£ð•½ð™ð–¼µáŽ¡ð–±ð—¥ð‘¹á’Ê€ð“¡",
        "S" => "á•ðµ  ðš‚ð—¦ð–²á‚½Ð…ð’ð‘ºð•Šï¼³ð•¾ð‘†ð–¼ºðŠ–Sð™Žð’®ð“¢ê“¢sï½“ð˜šášÕÑ•ð”–ð ",
        "T" => "âŸ™ðž£ð‘¢¼áŽ¢ðŠ—ðž½Î¤Ñ‚á´›ð“ð’¯ð™ð–³ðœâ²¦Ï„ð•‹ê­²ð‘»ð—§ð‘‡ï¼´ðŠ±ðŒ•ð–¼ŠTð›•ðš»ð‰âŠ¤Ð¢ð”—ê“”ðœ¯ð©ð˜›ð›µðŸ¨ðžƒð•¿ð“£ðšƒ",
        "U" => "Ã›Ãœð–½‚ð”˜ð“¤ð“Žðš„ÕUï¼µð—¨ð‘¼Ô±ð™â‹ƒuð‘¢¸ð‘ˆÎ¼ð–€Ï…ð”áˆ€âˆªð•Œð–´ê“´á‘Œð’°ð˜œ",
        "V" => "ð™‘ð‘½ê“¦á™ðš…Ñ´â…¤ð•ð”™ð–¼ˆï¼¶ð•ê›Ÿð–ð—©ð˜ðˆVÛ·Ù§ð‘¢ ð”â´¸ð–µð‘‰ð“¥ð’±á¯",
        "W" => "ð˜žð—ªð–‚ð–ð‘£¦Ôœð–¶ï¼·ð“¦ð•Žï½—ê“ªWð™’wá”ðš†ð‘Šð”šð‘£¯ð’²ð‘¾áŽ³",
        "X" => "ï½˜ð•ðŒ—ðŠ´êž³ð’³ð›¸ï¼¸ð–ƒðœ²ð”›ê“«ð‘£¬ð˜Ÿð“§â…©ð—ðž¦Î§ðš‡ð”§ð‘‹â•³ðŠðš¾ð—«áš·ð™“Xâ²¬âµð¬ð‘¿Ï‡ðŒ¢Ð¥ð–·á™­",
        "Y" => "Å¸áŽ©ðªð’€Êï½™ð–„Ò®ð˜Ï’ð’´Î³ð–½ƒð™”ðš¼ð”œð‘¢¤áŽ½ðšˆðž¤ê“¬yð“¨Ñƒð˜ ð›¶ï¼¹Yð‘ŒÐ£â²¨ð—¬ðŠ²ðœ°Î¥ð–¸ð•",
        "Z" => "ðš‰ð™ð’µð™•â„¨â„¤ð˜¡ðž•ð’ð–¹áƒð›§ð“©ð‘¢©Î–ðœ¡ð‹µð–…ê“œï¼ºð›ð—­ð‘ð‘£¥ðš­Z"
    );

    private static function removeEmojis( $string ) {
        $string = str_replace( "{%}", "\\{\\%\\}", $string );
        $string = str_replace( "?", "{%}", $string );
        $string  = mb_convert_encoding( $string, "ISO-8859-1", "UTF-8" );
        $string  = mb_convert_encoding( $string, "UTF-8", "ISO-8859-1" );
        $string  = str_replace( array( "?", "? ", " ?" ), array(" "), $string );
        $string  = str_replace( "{%}", "?", $string );
        $string = str_replace( "\\{\\%\\}", "{%}", $string );
        return $string;
    }

    /**
     * Translate homoglyphes to their normalized one and clean text
     */
    public static function normalize($text, $processHomoglyphes = true)
    {
        $text = trim($text);

        if($processHomoglyphes)
        {
            $text = mb_str_split($text);

            foreach ($text as &$letter) {
                foreach (TextHelper::homoglyphes as $replacement => $glyphes) {
                    if (mb_strstr($glyphes, $letter)) {
                        $letter = $replacement;
                        break;
                    }
                }
            }
            $text = (implode('', $text));
        }

        $text = preg_replace('/[[:cntrl:]]/', ' ', $text);

        $text = self::removeEmojis($text);
        $text = preg_replace('/\s+/', ' ', $text);

        return $text;
    }
}
